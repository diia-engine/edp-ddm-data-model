<?xml version="1.0" encoding="UTF-8"?>  

<databaseChangeLog  
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"  
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"  
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.2.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <changeSet author="register owner" id="procedure p_raise_notice" runOnChange="true">
        <comment>CREATE PROCEDURE p_format_sys_columns</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_raise_notice.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_raise_notice;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_get_source_data_id" runOnChange="true">
        <comment>CREATE FUNCTION f_get_source_data_id</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_get_source_data_id.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_get_source_data_id;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_get_id_name" runOnChange="true">
        <comment>CREATE FUNCTION f_get_id_name</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_get_id_name.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_get_id_name;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="procedure p_format_sys_columns" runOnChange="true">
        <comment>CREATE PROCEDURE p_format_sys_columns</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_format_sys_columns.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_format_sys_columns;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_check_permissions" runOnChange="true">
        <comment>CREATE FUNCTION f_check_permissions</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_check_permissions.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_check_permissions;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_row_insert" runOnChange="true">
        <comment>CREATE FUNCTION f_row_insert</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_row_insert.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_row_insert;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="procedure p_row_update" runOnChange="true">
        <comment>CREATE PROCEDURE p_row_update</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_row_update.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_row_update;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="procedure p_row_delete" runOnChange="true">
        <comment>CREATE PROCEDURE p_row_delete</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_row_delete.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_row_delete;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_get_tables_to_replicate" runOnChange="true">
        <comment>CREATE FUNCTION f_get_tables_to_replicate</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_get_tables_to_replicate.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE f_get_tables_to_replicate;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_get_tables_to_replicate@worker" runOnChange="true" labels="citus">
        <comment>CREATE FUNCTION f_get_tables_to_replicate</comment>
        <sql dbms="postgresql" endDelimiter=";" splitStatements="true" stripComments="true">
            SELECT create_distributed_function('f_get_tables_to_replicate(text)');
        </sql>
    </changeSet>

    <changeSet author="register owner" id="procedure p_alter_publicaton" runOnChange="true">
        <comment>CREATE PROCEDURE p_alter_publicaton</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_alter_publicaton.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_alter_publicaton;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="procedure p_alter_publicaton@workers" runOnChange="true" labels="citus">
        <comment>CREATE PROCEDURE p_alter_publicaton</comment>
        <sql dbms="postgresql" endDelimiter=";" splitStatements="true" stripComments="true">
            SELECT create_distributed_function('p_alter_publicaton(text)');
        </sql>
    </changeSet>

    <changeSet author="registry owner" id="function f_edrpou_is_correct" runOnChange="true">
        <comment>CREATE FUNCTION f_edrpou_is_correct</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_edrpou_is_correct.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_edrpou_is_correct;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="function f_get_ref_record" runOnChange="true">
        <comment>CREATE FUNCTION f_get_ref_record</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_get_ref_record.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_get_ref_record;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="function f_get_id_from_ref_table" runOnChange="true">
        <comment>CREATE FUNCTION f_get_id_from_ref_table</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_get_id_from_ref_table.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_get_id_from_ref_table;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="function f_get_id_from_ref_array_table" runOnChange="true">
        <comment>CREATE FUNCTION f_get_id_from_ref_array_table</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_get_id_from_ref_array_table.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_get_id_from_ref_array_table;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="procedure p_load_table_from_csv" runOnChange="true">
        <comment>CREATE PROCEDURE p_load_table_from_csv</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_load_table_from_csv.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_load_table_from_csv; DROP TYPE refs;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="procedure p_init_new_hist_table" runOnChange="true">
        <comment>CREATE PROCEDURE p_init_new_hist_table</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_init_new_hist_table.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_init_new_hist_table;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="procedure p_version_control" runOnChange="true">
        <comment>CREATE PROCEDURE p_version_control</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_version_control.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_version_control;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="procedure p_grant_analytics_user" context="sub" runOnChange="true">
        <comment>CREATE PROCEDURE p_load_table_from_csv</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_grant_analytics_user.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_grant_analytics_user;</sql>
        </rollback>
    </changeSet>

    <changeSet author="registry owner" id="procedure p_refresh_analytics_user" context="sub" runOnChange="true">
        <comment>CREATE PROCEDURE p_load_table_from_csv</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/p_refresh_analytics_user.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP PROCEDURE p_refresh_analytics_user;</sql>
        </rollback>
    </changeSet>

    <changeSet author="register owner" id="function f_check_permissions_dcm" runOnChange="true">
        <comment>CREATE FUNCTION f_check_permissions_dcm</comment>
        <createProcedure dbms="postgresql" encoding="UTF-8" path="procedures/f_check_permissions_dcm.sql" relativeToChangelogFile="true"/>
        <rollback>
            <sql splitStatements="true" stripComments="false">DROP FUNCTION f_check_permissions_dcm;</sql>
        </rollback>
    </changeSet>

</databaseChangeLog>
