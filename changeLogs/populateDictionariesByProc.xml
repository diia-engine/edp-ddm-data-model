<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.2.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext xsd/dbchangelog-ext.xsd">

	<property  name="dataLoadPath"  value="D:\PostgreSQL\csv\"/>

	<changeSet author="registry owner" id="load data to dictionaries">
		<sql dbms="postgresql" endDelimiter=";" splitStatements="true" stripComments="true">
			CALL p_load_table_from_csv('research','${dataLoadPath}01-Typy doslidgen.csv', array['code','research_type'], array['research_type']);
			CALL p_load_table_from_csv('refusal_reason','${dataLoadPath}02-Prichiny vidmov.csv', array['code','document_type','name','constant_code'], array['document_type','name','constant_code']);
			CALL p_load_table_from_csv(
			'koatuu'
			,'${dataLoadPath}03-KOATUU_simple.csv'
			, array['code','category','name']
			, array['code','category','name'
			,'level1::substring(code,1,2)||''00000000'''
			,'level2::substring(code,1,5)||''00000'''
			,'type::CASE WHEN code ~ ''[0-9]{2}0{8}'' AND code !~ ''(80|85)0{8}'' THEN ''О''
			WHEN code ~ ''[0-9]{2}2[0-9]{2}0{5}'' AND code !~ ''[0-9]{2}20{7}'' THEN ''Р''
			WHEN coalesce(category, ''Р'') != ''Р''
			OR code IN (SELECT DISTINCT substring(code,1,5)||''00000'' FROM koatuu_csv k2 WHERE category = ''Р'') AND category IS NULL
			OR code ~ ''(80|85)0{8}'' THEN ''НП''
			ELSE NULL END']
			);
			CALL p_load_table_from_csv('ownership','${dataLoadPath}04-Klasifikazia_form_vlasnosti.csv', array['code','name']);
			CALL p_load_table_from_csv('kopfg','${dataLoadPath}Kopfg.csv', array['code','name']);
			CALL p_load_table_from_csv('solution_type','${dataLoadPath}06-Typy rishen.csv', array['id','name','constant_code'], array['name','constant_code']);
			CALL p_load_table_from_csv('application_type','${dataLoadPath}07-Typy zayav.csv', array['id','name','constant_code'], array['name','constant_code']);
			CALL p_load_table_from_csv('staff_status','${dataLoadPath}08-Status spivrobitnika.csv', array['code','name','constant_code'], array['name','constant_code']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}Fizichni factory.csv', array['curr_name','name','notes'], array['name','factor_type::''Фізичний''']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}Biologichni factory(reglament).csv', array['code','name','col3','col4','col5','col6','notes'], array['code','name','factor_type::''Біологічний''']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}Trudovogo procesu factory.csv', array['curr_name','name','notes'], array['name','factor_type::''Трудового процесу''']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}(A,B,G lineynist) Himichny_Factory_HOST.csv', array['code','name','col3','col4','col5','col6','col7','notes'], array['code','name','factor_type::''Хімічний: ГОСТ''']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}(A,B,G lineynist) Himichny_factory_gigienichny.csv', array['code','name','col3','col4','col5','col6','col7','col8','notes'], array['code','name','factor_type::''Хімічний: Гігієнічні регламенти''']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}Himichni_factory_OBRV.csv', array['code','name','col3','col4','notes'], array['code','name','factor_type::''Хімічний: ОБРВ''']);
			CALL p_load_table_from_csv('factor','${dataLoadPath}Himichni factory dovilni.csv', array['code','name','notes'], array['code','name','notes','factor_type::''Хімічний: довільні''']);
		</sql>
  </changeSet>

</databaseChangeLog>
